config {
  type: "table",
  materialized: "table"
}

${when(var('ecommerce_warehouse_transaction_sources'), `

with transactions_merge_list as
  (
    ${{ var('ecommerce_warehouse_transaction_sources').map((source, index, array) => `

      select
        '${source}' as source,
        *
        from "${source}_transactions"

        ${index < array.length - 1 ? `union all` : ''}      
`).join('') }}
  )
select * from transactions_merge_list

`)} ${otherwise(`
 
`)}