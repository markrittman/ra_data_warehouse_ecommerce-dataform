config {
type: "table",
enabled: "${target.type == 'redshift'}"
}

"${when(env("ecommerce_warehouse_product_sources"), 
${when('shopify_ecommerce' in env("ecommerce_warehouse_product_sources"), `
with source as (
  select * from ${ref('shopify__products')}
),
renamed as (
    select
      created_timestamp,
      handle ,
      product_id ,
      product_type ,
      published_timestamp ,
      published_scope ,
      title ,
      updated_timestamp ,
      vendor ,
      source_relation ,
      quantity_sold ,
      subtotal_sold ,
      quantity_sold_net_refunds ,
      subtotal_sold_net_refunds ,
      first_order_timestamp ,
      most_recent_order_timestamp
    from source
)
select * from renamed
`)} ${otherwise(`  `)}
)} ${otherwise(`  `)}"